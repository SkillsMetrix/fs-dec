package com.example.kafka;

import org.apache.kafka.clients.producer.*;

import java.util.Properties;

public class PaymentProducer {
    public static void main(String[] args) throws Exception {

        Properties props = new Properties();
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringSerializer");
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringSerializer");
        props.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, PaymentPartitioner.class.getName());

        Producer<String, String> producer = new KafkaProducer<>(props);

        String[] keys = {"upi", "card", "cash", "upi", "card"};

        for (int i = 0; i < keys.length; i++) {
            ProducerRecord<String, String> r =
                    new ProducerRecord<>("payments-topic", keys[i], "msg-" + i);

            RecordMetadata meta = producer.send(r).get();

            System.out.println(keys[i] + " -> partition " + meta.partition());
        }

        producer.close();
    }
}
---


package com.example.kafka;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.apache.kafka.clients.producer.Partitioner;
import org.apache.kafka.common.Cluster;
import org.apache.kafka.common.utils.Utils;

import java.io.InputStream;
import java.util.Map;

public class PaymentPartitioner implements Partitioner {

    private Map<String, Integer> routing;

    @Override
    public void configure(Map<String, ?> configs) {
        try {
            InputStream is = getClass().getResourceAsStream("/routing.json");
            routing = new ObjectMapper().readValue(is, new TypeReference<Map<String, Integer>>() {});
        } catch (Exception e) {
            routing = Map.of();
        }
    }

    @Override
    public int partition(String topic, Object keyObj, byte[] keyBytes,
                         Object value, byte[] valueBytes, Cluster cluster) {

        int count = cluster.partitionCountForTopic(topic);
        if (keyObj == null) return 0;

        String key = keyObj.toString().toLowerCase();

        if (routing.containsKey(key))
            return routing.get(key) % count;

        return Utils.toPositive(key.hashCode()) % count;
    }

    @Override
    public void close() {}
}
