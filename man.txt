package csv;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.Properties;

import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.Producer;
import org.apache.kafka.clients.producer.ProducerConfig;
import org.apache.kafka.clients.producer.ProducerRecord;

public class PaymentProducer {
	public static void main(String[] args) throws InterruptedException, IOException {
		String bootstrap = "localhost:9092";
        String topic = "payment-topic";

        Properties props = new Properties();
        
        props.put("bootstrap.servers", bootstrap);
        props.put("key.serializer",
                  "org.apache.kafka.common.serialization.StringSerializer");
        props.put("value.serializer",
                  "org.apache.kafka.common.serialization.StringSerializer");

        
        KafkaProducer<String, String> p= new KafkaProducer<String, String>(props);
        
        String csvFile="C:/data/payments.csv";
        
        BufferedReader br= new BufferedReader(new FileReader(csvFile));
        String line;
        br.readLine();
        while((line= br.readLine()) !=null) {
        	p.send(new ProducerRecord<>("payments-input",null,line));
        	System.out.println("Sent "+line);
        }
      
      
        p.close();
        System.out.println("Producer Done its Job....!");
       
   
	}

}



-----------

package csv;

import java.time.Duration;
import java.util.Collections;
import java.util.Properties;

import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.apache.kafka.clients.consumer.ConsumerRecords;
import org.apache.kafka.clients.consumer.KafkaConsumer;
import org.apache.kafka.common.errors.WakeupException;
 
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;

public class AggregatesConsumer {
    private static final ObjectMapper mapper = new ObjectMapper();

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put("bootstrap.servers","localhost:9092");
        props.put("group.id","csv-reader");
        props.put("key.deserializer","org.apache.kafka.common.serialization.StringDeserializer");
        props.put("value.deserializer","org.apache.kafka.common.serialization.StringDeserializer");
        props.put("auto.offset.reset","earliest");
        
        KafkaConsumer<String,String> consumer = new KafkaConsumer<>(props);
        consumer.subscribe(Collections.singletonList("payments-aggregates"));
        
        System.out.println("AggregatesConsumer started...");
      
            while (true) {
                ConsumerRecords<String,String> records = consumer.poll(Duration.ofMillis(500));
                for(ConsumerRecord<String, String> r: records) {
                	String[] agg= r.value().split(",");
                	 System.out.printf("%s : count=%s total=%s%n",
                             r.key(),
                            agg[0],
                            agg[1]);
                }
                
             
            }}
}
    

